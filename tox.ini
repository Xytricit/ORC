# Tox configuration for testing across multiple Python versions
# Run with: tox

[tox]
envlist = py38,py39,py310,py311,py312,lint,type
isolated_build = True
skip_missing_interpreters = True

[testenv]
description = Run tests with pytest
deps =
    pytest>=7.0.0
    pytest-cov>=4.0.0
    pytest-xdist>=3.0.0
    -r{toxinidir}/requirements.txt
commands =
    pytest {posargs:orc/tests} -v --cov=orc --cov-report=term-missing --cov-report=html --cov-report=xml

[testenv:lint]
description = Run linting checks
skip_install = True
deps =
    black>=23.0.0
    flake8>=6.0.0
    isort>=5.12.0
commands =
    black --check orc
    flake8 orc
    isort --check-only orc

[testenv:format]
description = Auto-format code
skip_install = True
deps =
    black>=23.0.0
    isort>=5.12.0
commands =
    black orc
    isort orc

[testenv:type]
description = Run type checking with mypy
deps =
    mypy>=1.0.0
    types-PyYAML
    types-requests
    -r{toxinidir}/requirements.txt
commands =
    mypy orc --ignore-missing-imports

[testenv:docs]
description = Build documentation
deps =
    sphinx>=6.0.0
    sphinx-rtd-theme>=1.2.0
commands =
    sphinx-build -W -b html docs docs/_build/html

[testenv:security]
description = Run security checks
deps =
    bandit>=1.7.0
    safety>=2.3.0
commands =
    bandit -r orc -ll
    safety check

[flake8]
max-line-length = 100
extend-ignore = E203, W503, E501
exclude =
    .git,
    __pycache__,
    .tox,
    .venv,
    venv,
    build,
    dist,
    *.egg-info,
    orc/tests,
    orc/orc,
    orc/orc_package

[pytest]
testpaths = orc/tests
python_files = test_*.py
python_classes = Test*
python_functions = test_*
addopts = -v --tb=short --strict-markers
markers =
    slow: marks tests as slow (deselect with '-m "not slow"')
    integration: marks tests as integration tests
    unit: marks tests as unit tests
